{% load i18n admin_static %}
{% load staticfiles i18n compress %}
{% load humanize %}

{% block extrastyle %}
    <link href="{% static 'css/font-awesome.css' %}" rel="stylesheet" media="all">
    <link rel="stylesheet" type="text/css" href="{% static 'css/naic722/dashboard/s.css' %}" media="all">
    <link href="{% static 'css/jquery-ui1.12.1.theme.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/jquery-ui1.12.1.structure.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/jquery.datetimepicker.css' %}" rel="stylesheet">
    <link href="{% static 'css/deleteconfirmation.css' %}" rel="stylesheet">
{% endblock %}

<form id="scheduleserviceform">
    <input type="hidden" name="scheduletype" id="scheduletype"  value="{{ scheduletype}}"/>
    <input type="hidden" name="modified_cssc_id" id="modified_cssc_id"  value="{{ service_schedule.cssc_id}}"/>
    <input type="hidden" name="cres_id" id="cres_id"  value="{{ cres_id }}"/>
    <div id="scddiv">
        <div style="text-align: center">
            <i class="fa fa-clock-o fa-3x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-form-img-titleheader"
               style="color: #073763"></i>
            <span class="oh_scd_servkeeComponent oh_scd_servkeeLabel newscd-form-titleheader">{{ rectype }}</span>
            <input type="hidden" name="recordtype" id="recordtype"  value="{{ rectype }}"/>
        </div>
        <div class="oh_scd_servkeeComponent oh_scd_servkeeHrule newscd-form-titleheader-horizontol"></div>
        <div>
            <span class="oh_scd_servkeeComponent oh_scd_servkeeLabel newscd-label-service">{{ rectype }}</span>
            <span class="oh_scd_servkeeComponent oh_scd_servkeeLabel newscd-label-service-content">{{ service.srvj.ctyp.ctyp_desc }}</span>
            <input type="hidden" name="recordtype_id" id="recordtype_id"  value="{{ service.csrv_id }}"/>
        </div>
        <div>
            <span class="oh_scd_servkeeComponent oh_scd_servkeeLabel newscd-label-duedate">Due date</span>
            <input type="text" value="{{ csrv_due_date }}" readonly
                   class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newscd-label-duedate-content"/>

            <span class="oh_scd_servkeeComponent oh_scd_servkeeLabel newscd-label-lastamtpaid">Last Amount paid:</span>
            <span class="oh_scd_servkeeComponent oh_scd_servkeeLabel newscd-label-lastamtpaid-content">{% if csac_price_last != 'None' %}
                $&nbsp;
                {{ csac_price_last }} {% else %} - {% endif %}</span>
            {% if csac_service_date_last %}
                {% if off_from_avg <= 0 %}
                    <i
                            class="fa fa-thumbs-o-up fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-lastamt-valueformoney"
                            style="color: #72a525"></i>
                {% else %}
                    <i
                            class="fa fa-thumbs-o-down fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-lastamt-valueformoney"
                            style="color: red"></i>
                {% endif %}
            {% endif %}
        </div>

        <div>
            <div class="oh_scd_servkeeComponent oh_scd_servkeeParagraph newscd-label-serviceprovider" cellspacing="0"
                 cellpadding="0">
                Service
                provider :
            </div>
            <select id="vendorlist" name="vendorlist"
                    class="oh_scd_servkeeComponent oh_scd_servkeeCombobox newscd-dropdown-serviceprovider">
                {% ifequal scheduletype 'mod'%}
                    {% if service_schedule %}
                         {% for serviceprovider in serviceproviderlist %}
                        <option value="{{ serviceprovider.comp_id }}" {% ifequal serviceprovider.comp_id service_schedule.comp_id %}selected{% endifequal %}>{{ serviceprovider.comp_name}}</option>
                    {% endfor %}
{#                   <option value="{{ service_schedule.comp_id }}" selected>{{ service_schedule.comp.name }}</option>#}
                    {% endif %}
                 {% else %}
                    {% ifequal scheduletype 'new'%}
                    <option value="" selected>Select Vendor</option>
                    {% for serviceprovider in serviceproviderlist %}
                        <option value="{{ serviceprovider.comp_id }}" >{{ serviceprovider.comp_name}}</option>
                    {% endfor %}
                        {% else %}
                        <option value="{{ service_schedule.comp_id }}" selected>{{ service_schedule.comp.name }}</option>
                    {% endifequal %}
                {% endifequal %}

            </select>
            <a href=""
               onclick="return  schedulepopupnewvendor('/app/newvendor/?type={{ rectype }}&service={{ record.csrv_id }}&scdtyp=newvendor')"
               class="dismiss" onclick='javascript:openDialog()' title="Add new Service Provider">
                <i id="vendoraddicon" name="vendoraddicon"
                   class="fa fa-plus-square-o fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-img-contact"
                   style="color: #f72006"></i>
            </a>

            <i id="vendorcontactrefreshicon" name="vendorcontactrefreshicon"
               class="fa fa-refresh fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-img-contact"
               style="color: #1D9D73;visibility: hidden;font-weight: bold;margin-left: 5px;"></i>
        </div>

        <div>
            <div class="oh_scd_servkeeComponent oh_scd_servkeeParagraph newscd-label-contact" cellspacing="0"
                 cellpadding="0">
                Contact/Department:
            </div>

            <select id="vendorcontactlist" name="vendorcontactlist"
                    class="oh_scd_servkeeComponent oh_scd_servkeeCombobox newscd-dropdown-contact">
                {% ifequal scheduletype 'mod'%}
                    {% if service_schedule %}
                   <option value="{{ service_schedule.cprs_id_provider }}" selected>{{ service_schedule.cprs_id_provider.prsn.first_name }}&nbsp;{{ service_schedule.cprs_id_provider.prsn.last_name }}</option>
                    {% endif %}
                {% endifequal %}
                <option value="">Select contact</option>
            </select>
            <i id="vendorcontactaddicon" name="vendorcontactaddicon"
               class="fa fa-plus-square-o fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-img-serviceprovider"
               style="color: #f72006"></i>
        </div>

        <div>
            <div class="oh_scd_servkeeComponent oh_scd_servkeeParagraph newscd-label-phone" cellspacing="0"
                 cellpadding="0">
                Phone
                no:<br/></div>
             {% ifequal scheduletype 'mod'%}
                    {% if service_schedule %}
                        <input id="phone" name="phone" type="text" value="{{ service_schedule.cprs_id_provider.prsn.office_phone }}" placeholder="Phone number"
                       class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newscd-input-phone"/>
                    {% endif %}
             {% else %}
                <input id="phone" name="phone" type="text" value="" placeholder="Phone number"
                       class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newscd-input-phone"/>
            {% endifequal %}
            <i class="fa fa-phone fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-img-phone"
               style="color: #080041"></i>
        </div>

        <div>
            <div class="oh_scd_servkeeComponent oh_scd_servkeeParagraph newscd-label-email" cellspacing="0"
                 cellpadding="0">
                Email
                :<br/></div>
            {% ifequal scheduletype 'mod'%}
                    {% if service_schedule %}
                        <input id="email" name="email" type="text" value="{{ service_schedule.cprs_id_provider.prsn.email }}" placeholder="Email address"
                   class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newscd-input-email"/>
                    {% endif %}
             {% else %}
                <input id="email" name="email" type="text" value="" placeholder="Email address"
                   class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newscd-input-email"/>
            {% endifequal %}

            <i class="fa fa-envelope-o fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-img-email"
               style="color: #080041"></i>
        </div>
        <div>
            <span class="oh_scd_servkeeComponent oh_scd_servkeeLabel newscd-label-schedule">Scheduled:</span>
             {% ifequal scheduletype 'mod'%}
                    {% if service_schedule %}
                        <input id="id_schdeduledinputcal" name="id_schdeduledinputcal" type="text" value="{{ service_schedule.cssc_service_date|date:"m/d/y H:m" }}"
                   class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newscd-input-schedule"/>
                    {% endif %}
             {% else %}
                <input id="id_schdeduledinputcal" name="id_schdeduledinputcal" type="text" value=""
                   class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newscd-input-schedule"/>
            {% endifequal %}

            <i id="id_schdeduledcalicon" name="id_schdeduledcalicon"
               class="fa fa-calendar fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-img-schedule"
               style="color: #080041"></i>
            <span id="calendar_message" name="calendar_message"
                  class="oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-calmsg-schedule oh-alert-error apphelp-block"></span>
        </div>

        <div>
            <span class="oh_scd_servkeeComponent oh_scd_servkeeLabel newscd-label-note">Notes:</span>
            <div class="oh_scd_servkeeRelativeComponent newscd-textarea-note">
            {% ifequal scheduletype 'mod'%}
                {% if service_schedule %}
                     <textarea id="notes" name="notes" rows="4" cols="50" value="" style="word-wrap: break-word"
                          placeholder="Enter your notes related to the scheduled service">{{ service_schedule.cssc_note}}</textarea>
                    {% endif %}
             {% else %}
                <textarea id="notes" name="notes" rows="4" cols="50" value="" style="word-wrap: break-word"
                          placeholder="Enter your notes related to the scheduled service"></textarea>
            {% endifequal %}
            </div>
        </div>

           <div>
            <div class="oh_scd_servkeeComponent oh_scd_servkeeParagraph newscd-label-responsible" cellspacing="0"
                 cellpadding="0">
                Responsible :
            </div>
            <select id="responsiblelist" name="responsiblelist"
                    class="oh_scd_servkeeComponent oh_scd_servkeeCombobox newscd-dropdown-responsible" >
                {% ifequal scheduletype 'mod'%}
{#                    {% if responsiblelist %}#}
{#                   <option value="{{ service_schedule.cprs_id_provider }}" selected>{{ service_schedule.cprs_id_provider.prsn.first_name }}&nbsp;{{ service_schedule.cprs_id_provider.prsn.last_name }}</option>#}
{#                    {% endif %}#}
                        {% for responsible in responsiblelist %}
{#                                {% if cres_id %}#}
{#                                    <option value="{{ responsible.cres_id }}" {% ifequal responsible.cprs_id cprs_id_responsible %}selected{% endifequal %}>{{ responsible.prsn.first_name}}&nbsp;{{ responsible.prsn.last_name }}</option>#}
{#                                {% else %}#}
                                    <option value="{{ responsible.cprs_id }}" {% ifequal responsible.cprs_id service_schedule.cprs_id_responsible_id %}selected{% endifequal %}>
                                        {{ responsible.prsn.first_name}}&nbsp;{{ responsible.prsn.last_name }}</option>
{#                                {% endif %}#}

                        {% endfor %}
                {% else %}
                        {% for responsible in responsiblelist %}
                            {% if cres_id %}
                                <option value="{{ responsible.cres_id }}" {% ifequal responsible.cprs_id cprs_id_responsible %}selected{% endifequal %}>{{ responsible.prsn.first_name}}&nbsp;{{ responsible.prsn.last_name }}</option>
                            {% else %}
                                <option value="{{ responsible.cprs_id }}" {% ifequal responsible.cprs_id loggeduser_cprs_id %}selected{% endifequal %}>
                                    {{ responsible.prsn.first_name}}&nbsp;{{ responsible.prsn.last_name }}</option>
                            {% endif %}

                        {% endfor %}
                {% endifequal %}

                <option value="">Select contact</option>
            </select>
           <i id="id_schdeduledcalicon" name="id_schdeduledcalicon"
               class="fa fa-users fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-img-responsible"
               style="color: #080041"></i>
        </div>

        <div>
            <i class="fa fa-user-o   fa-3x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newvendor-img-custexp"
               style="color: #073763"></i>
            <div class="oh_scd_servkeeComponent oh_scd_servkeeParagraph newscd-label-custexp" cellspacing="0"
                 cellpadding="0">
                Customer Experience<br/></div>
            <div class="oh_scd_servkeeComponent oh_scd_servkeeCanvas newscd-div-custexp-content">

                <div class="oh_scd_servkeeRelativeComponent oh_scd_servkeeParagraph newscd-label-jurisdiction-value"
                     cellspacing="0"
                     cellpadding="0">NYC<br/></div>

                <div class="oh_scd_servkeeRelativeComponent oh_scd_servkeeParagraph newscd-label-overall-value"
                     cellspacing="0"
                     cellpadding="0">Overall<br/></div>

                <div class="oh_scd_servkeeRelativeComponent oh_scd_servkeeParagraph newscd-label-custexp-arrivesontime"
                     cellspacing="0"
                     cellpadding="0">Arrives on time<br/></div>
                <div class="oh_scd_servkeeRelativeComponent oh_scd_servkeeParagraph newscd-label-custexp-arrivesontime-value-jur"
                     cellspacing="0"
                     cellpadding="0">75%<br/></div>
                <div class="oh_scd_servkeeRelativeComponent oh_scd_servkeeParagraph newscd-label-custexp-arrivesontime-value-ovr"
                     cellspacing="0"
                     cellpadding="0">85%<br/></div>

                <div class="oh_scd_servkeeRelativeComponent oh_scd_servkeeParagraph newscd-label-custexp-compontime"
                     cellspacing="0"
                     cellpadding="0">Completes on time<br/></div>
                <div class="oh_scd_servkeeRelativeComponent oh_scd_servkeeParagraph newscd-label-custexp-compontime-value-jur"
                     cellspacing="0"
                     cellpadding="0">25%<br/></div>
                <div class="oh_scd_servkeeRelativeComponent oh_scd_servkeeParagraph newscd-label-custexp-compontime-value-ovr"
                     cellspacing="0"
                     cellpadding="0">65%<br/></div>

                <div class="oh_scd_servkeeRelativeComponent oh_scd_servkeeParagraph newscd-label-custexp-satwithjob"
                     cellspacing="0"
                     cellpadding="0">Satisfied with Job<br/></div>
                <div class="oh_scd_servkeeRelativeComponent oh_scd_servkeeParagraph newscd-label-custexp-satwithjob-value-jur"
                     cellspacing="0"
                     cellpadding="0">75%<br/></div>
                <div class="oh_scd_servkeeRelativeComponent oh_scd_servkeeParagraph newscd-label-custexp-satwithjob-value-ovr"
                     cellspacing="0"
                     cellpadding="0">95%<br/></div>

            </div>
                <div>
                    <div title="star rating">
                        <i id="id_schdeduledcalicon" name="id_schdeduledcalicon"
               class="fa fa-star fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-img-biz-rating-star1"
               style="color: #ff0016"></i>
                        <i id="id_schdeduledcalicon" name="id_schdeduledcalicon"
               class="fa fa-star fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-img-biz-rating-star2"
               style="color: #ff0016"></i>
                        <i id="id_schdeduledcalicon" name="id_schdeduledcalicon"
               class="fa fa-star-half-o fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-img-biz-rating-star3"
               style="color: #ff0016"></i>
                        <i id="id_schdeduledcalicon" name="id_schdeduledcalicon"
               class="fa fa-star-o fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-img-biz-rating-star4"
               style="color: #ff0016"></i>
                        <i id="id_schdeduledcalicon" name="id_schdeduledcalicon"
               class="fa fa-star-o fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newscd-img-biz-rating-star5"
               style="color: #ff0016"></i>
                    </div>
                     <span class="oh_scd_servkeeComponent oh_scd_servkeeLabel newscd-div-biz-rating">333 reviews</span>
                </div>
        </div>
        <div style="margin-top:470px;text-align: right;margin-right: 100px">
              {% ifequal scheduletype 'mod'%}
                {% if service_schedule %}
                    <div class="btn">
                          <div class="btn-back" style="display: inline">
                            <p>Are you sure you want to do that?</p>
                            <button class="yes">Yes</button>
                            <button class="no">No</button>
                          </div>
                            <div class="btn-front" style="font-size: 14px; margin-left: 4px;color: red;background-color: transparent; border: transparent;font-weight: bolder;"><i class="fa fa-trash-o fa-2x"
                            style="color: Red"></i>&nbsp;Delete Schedule</button>
                            </div>
                    </div>
                    <button type="button" id="updateschedule" class="ui-button ui-corner-all ui-widget"
                    style="font-size: 14px; margin-left: 4px;color: #1E9E74;background-color: transparent; border: transparent;font-weight: bolder;">
                        <i class="fa fa-pencil-square-o fa-2x" style="color: #1E9E74"></i>&nbsp;Update Schedule
                    </button>
{#                    <button type="button" id="deleteschedule" class="ui-button ui-corner-all ui-widget"#}
{#                    style="font-size: 14px; margin-left: 4px;color: Red;background-color: transparent; border: transparent;font-weight: bolder;">#}
{#                        <i class="fa fa-trash-o fa-2x"#}
{#               style="color: Red"></i>&nbsp;Delete Schedule</button>#}
                    {% endif %}
             {% else %}
                  <button type="button" id="createschedule" class="ui-button ui-corner-all ui-widget"
                    style="font-size: 14px; margin-left: 4px;color: #1E9E74;background-color: transparent; border: transparent;font-weight: bolder;">
                        <i class="fa fa-pencil-square-o fa-2x" style="color: #1E9E74"></i>&nbsp;Create Schedule
                    </button>
            {% endifequal %}

        <button type="button" id="cancel" class="ui-button ui-corner-all ui-widget"
                    style="font-size: 14px; margin-left: 4px;color: #0E63B6;background-color: transparent; border: transparent;font-weight: bolder;">
                        <i class="fa fa-times-circle fa-2x" style="color: #0E63B6"></i>&nbsp;Cancel
                    </button>
        </div>
        <div style="margin-top:0px;text-align: left;margin-right: 100px">
        <span id="form_action_message" name="form_action_message"></span>
        </div>
    </div>
    <div id="dialogschedulepopnewvendor">
        <iframe id="newvendorIframe" src="" width="" height=""
                style="border: none;margin-top: -1px;margin-left: -3px"></iframe>
    </div>

</form>
{% block extrajs %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery-3.1.1.min.js"></script>

    {% compress js %}
        <script src="{% static 'js/jquery-ui1.12.1.js' %}"></script>
        <script src="{% static 'js/moment-2.17.1.min.js' %}"></script>
        <script src="{% static 'js/jquery.datetimepicker.js' %}"></script>
        <script src="{% static 'js/deleteconfirmation.js' %}"></script>
    {% endcompress %}

    <script type="text/javascript" language="javascript">
    {% ifequal scheduletype 'mod'%}
                {% if service_schedule %}

    var btn = document.querySelector('.btn');
var btnFront = btn.querySelector('.btn-front'), btnYes = btn.querySelector('.btn-back .yes'), btnNo = btn.querySelector('.btn-back .no');
btnFront.addEventListener('click', function (event) {
    var mx = event.clientX - btn.offsetLeft, my = event.clientY - btn.offsetTop;
    var w = btn.offsetWidth, h = btn.offsetHeight;
    var directions = [
        {
            id: 'top',
            x: w / 2,
            y: 0
        },
        {
            id: 'right',
            x: w,
            y: h / 2
        },
        {
            id: 'bottom',
            x: w / 2,
            y: h
        },
        {
            id: 'left',
            x: 0,
            y: h / 2
        }
    ];
    directions.sort(function (a, b) {
        return distance(mx, my, a.x, a.y) - distance(mx, my, b.x, b.y);
    });
    btn.setAttribute('data-direction', directions.shift().id);
    btn.classList.add('is-open');

});
btnYes.addEventListener('click', function (event) {
    btn.classList.remove('is-open');
    // alert('Yes Cliked');
    if (form_valid() == true) {
                perform_delete()
            }
    event.preventDefault();
});
btnNo.addEventListener('click', function (event) {
    btn.classList.remove('is-open');
    // alert('No clicked');
    event.preventDefault();
});
function distance(x1, y1, x2, y2) {
    var dx = x1 - x2;
    var dy = y1 - y2;
    return Math.sqrt(dx * dx + dy * dy);
}
{% endif %}
    {% endifequal %}
        $(document).ready(function () {

{#            var btn = document.querySelector( '.btn' );#}
{##}
{#            var btnFront = btn.querySelector( '.btn-front' ),#}
{#                btnYes = btn.querySelector( '.btn-back .yes' ),#}
{#                btnNo = btn.querySelector( '.btn-back .no' );#}

            $("#dialogschedulepopnewvendor").dialog({
                modal: true,
                {#                minHeight: 530,#}
                {#                minWidth: 634,#}
                minHeight: 520,
                minWidth: 670,
                resizable: false,
                draggable: false,
                autoOpen: false,
                dialogClass: "no-close",
                position: {
                    my: 'center',
                    at: 'center'
                },
            });

{#            $("#id_schdeduledinputcal").datepicker({#}
            $("#id_schdeduledinputcal").datetimepicker({

                minDate: 0,
                showButtonPanel: true,
                changeMonth: true,
                changeYear: true,
                showAnim: "fold",
                {#                buttonImage: "images/calendar.gif",#}
                // The hidden field to receive the date
                format:'m/d/y H:i',
{#                format:'H:i',#}
                altField: "#id_schdeduledinputcal",
                // The format you want
{#                altFormat: "mm/dd/y",#}
                // The format the user actually sees
{#                dateFormat: "mm/dd/y",#}
{#                "minTime":"00:00",#}
{#                "maxTime":"23:59",#}

                onSelect: function (date) {

                    // Your CSS changes, just in case you still need them
                    $('a.ui-state-default').removeClass('ui-state-highlight');
{#                    $(this).addClass('ui-state-highlight');#}
                }
            });


        });


        {#        $('#id_schdeduledcalicon').click(function () {#}
        {##}
        {#            $("#id_schdeduledinputcal").datepicker();#}
        {#        });#}

        $('#createschedule').click(function () {
            {#        alert('1');#}
            $("#dialogschedulepop").dialog("close");
            window.close();
        });

        function schedulepopupnewvendor(url) {
            $('#scddiv').hide();
            $('.ui-button.ui-corner-all.ui-widget').css('font-size', '14px');
            $('.ui-button.ui-corner-all.ui-widget').css('margin-left', '4px');

            $.ajax({
                url: url,
                success: function (data) {

                    console.log('url', url);
                    $("#scheduleIframe").attr("visibility", "hidden");
                    $("#dialogschedulepop").dialog("close");
                    $("#newvendorIframe").attr("src", url);
                    $("#newvendorIframe").attr("width", 670);
                    $("#newvendorIframe").attr("height", 520);
                    $("#newvendorIframe").attr("style", "border:None;font-family: Open Sans, sans-serif;");
                    $("#dialogschedulepopnewvendor").dialog("open");
                }
            });
            return false;
        }

        $('#cancel').click(function () {
            if (window.parent.$("#dialogschedulepop").dialog("isOpen") == true) {
                window.parent.$("#dialogschedulepop").dialog("close");
            }
        });

        function ValidateEmail(email) {
            if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email)) {
                return (true);
            }
            return (false);
        }


        function form_valid() {
            var form_valid = true;
            console.log($("#vendorlist option:selected").val());
            if ($("#vendorlist option:selected").val() == '') {
                form_valid = false;
                $('#vendorlist').addClass("oh_scd_servkeeComponent oh_scd_servkeeCombobox newscd-dropdown-serviceprovider  has-danger");

            } else {
                $('#vendorlist').removeClass("has-danger");
            }


            if (document.getElementById('email').value != '') {
                if (ValidateEmail(document.getElementById('email').value) == false) {
                    form_valid = false;
                    $('#email').addClass("oh_scd_servkeeComponent oh_scd_servkeeTextinput newscd-input-email has-danger");
                } else {
                    $('#email').removeClass("has-danger");
                }
            }

            if ($('#id_schdeduledinputcal').hasClass("has-danger"))
                $('#id_schdeduledinputcal').removeClass("has-danger");
            document.getElementById("calendar_message").innerHTML = "";
            if (document.getElementById('id_schdeduledinputcal').value != '') {
                console.log(moment(document.getElementById('id_schdeduledinputcal').value, 'MM/DD/YY', true));
                if (!moment(document.getElementById('id_schdeduledinputcal').value, 'MM/DD/YY HH:mm', true).isValid()) {
                    form_valid = false;
                    $('#id_schdeduledinputcal').addClass("oh_scd_servkeeComponent oh_scd_servkeeTextinput newscd-input-schedule hasDatepicker val-required has-danger");
                    document.getElementById("calendar_message").innerHTML = "Invalid scheduled date. Expected: MM/DD/YY";
                }
            } else {
                form_valid = false;
                $('#id_schdeduledinputcal').addClass("oh_scd_servkeeComponent oh_scd_servkeeTextinput newscd-input-schedule hasDatepicker val-required has-danger");
            }

            return form_valid;
        }

        function perform_updates(action) {

            console.log('All welll for Data updated');
                document.getElementById("form_action_message").innerHTML = "";
                modified_cssc_id = $('input:hidden[name=modified_cssc_id]').val();
                scheduletype = $('input:hidden[name=scheduletype]').val();
                recordtype = $('input:hidden[name=recordtype]').val();
                recordtype_id = $('input:hidden[name=recordtype_id]').val();
                cres_id = $('input:hidden[name=cres_id]').val();
                vendor = $("#vendorlist option:selected").val();
                vendorcontactrole = $("#vendorcontactlist option:selected").val();
                phone = document.getElementById('phone').value;
                email = document.getElementById('email').value;
                schedule = document.getElementById('id_schdeduledinputcal').value;
                notes = document.getElementById('notes').value;
                responsible = $("#responsiblelist option:selected").val();
                console.log('Form Valid -AJAX- Create Vendor call');
                $.ajax({
                    url: 'ajax_complianceservice_addnewschedule',
                    data: {
                        'action':action,
                        'modified_cssc_id':modified_cssc_id,
                        'scheduletype':scheduletype,
                        'recordtype': recordtype,
                        'recordtype_id': recordtype_id,
                        'vendor': vendor,
                        'vendorcontactrole': vendorcontactrole,
                        'phone': phone,
                        'email': email,
                        'schedule': schedule,
                        'notes': notes,
                        'responsible': responsible
                    },
                    dataType: 'json',
                    success: function (response_data) {
                        console.log(response_data.result);
                        if (response_data.result == 'success') {
                            window.parent.$("#dialogschedulepop").dialog("close");
                            window.parent.location.reload();
                        }

                    }
                });
        }

        function perform_delete() {
            console.log('All welll for Data updated');
                document.getElementById("form_action_message").innerHTML = "";
                action ='delete';
                modified_cssc_id = $('input:hidden[name=modified_cssc_id]').val();
                scheduletype = $('input:hidden[name=scheduletype]').val();
                recordtype = $('input:hidden[name=recordtype]').val();
                recordtype_id = $('input:hidden[name=recordtype_id]').val();
                vendor = $("#vendorlist option:selected").val();
                vendorcontactrole = $("#vendorcontactlist option:selected").val();
                phone = document.getElementById('phone').value;
                email = document.getElementById('email').value;
                schedule = document.getElementById('id_schdeduledinputcal').value;
                notes = document.getElementById('notes').value;
                responsible = $("#responsiblelist option:selected").val();
                console.log('Form Valid -AJAX- Create Vendor call');
                $.ajax({
                    url: 'ajax_complianceservice_addnewschedule',
                    data: {
                        'action':action,
                        'modified_cssc_id':modified_cssc_id,
                        'scheduletype':scheduletype,
                        'recordtype': recordtype,
                        'recordtype_id': recordtype_id,
                        'vendor': vendor,
                        'vendorcontactrole': vendorcontactrole,
                        'phone': phone,
                        'email': email,
                        'schedule': schedule,
                        'notes': notes,
                        'responsible': responsible
                    },
                    dataType: 'json',
                    success: function (response_data) {
                        console.log(response_data.result);
                        if (response_data.result == 'success') {
                            document.getElementById("form_action_message").innerHTML = "";
                            window.parent.$("#dialogschedulepop").dialog("close");
                            window.parent.location.reload();
                        }
                        if (response_data.result == 'error') {
                            document.getElementById("form_action_message").innerHTML = " Error: "+response_data.error_message;
                        }

                    }
                });

        }

        $('#createschedule').click(function () {
            if (form_valid() == true) {
                perform_updates('create')
            }
        });

         $('#updateschedule').click(function () {
            if (form_valid() == true) {
                perform_updates('update')
            }
        });

        $('#deleteschedule').click(function () {
            if (form_valid() == true) {
                perform_delete()
            }
        });

$('#vendorlist').on('change', function() {

    $('#vendorlist').removeClass("has-danger");
    console.log($("#vendorlist option:selected").val());

if($("#vendorlist option:selected").val() != '')
    {
{#        $("#vendorcontactlist")[0].selectedIndex = 1;#}
        $('#phone').text('');
        $('#email').text('');
        $('#vendorcontactlist').find('option').remove().end();
{#        document.getElementById('id_lastservicedate').value ='';#}

        $.ajax({
            url: 'ajax_vendorcontactlist',
            data: {
                'vendorselected': $("#vendorlist option:selected").val(),
            },
            dataType: 'json',
            success: function (response_data) {
                console.log(response_data.result);
                if (response_data.result == 'success' ) {

{#                    $("div.f_inp_bx select").val(response_data['frequency']);#}
{#                    $('#jurisdiction').text(response_data['jurisdiction']);#}
{#                    $('#servicedesc').text(response_data['compliance_desc']);#}
                    document.getElementById('phone').value =response_data['phone'];
                    document.getElementById('email').value =response_data['email'];
                    $('#vendorcontactlist').removeAttr('disabled');
                    $.each(response_data.vendorcontact, function (key, value) {
                        $('#vendorcontactlist').append(
                                $("<option></option>")
                                        .attr("value", value[0])
                                        .text(value[1])
                        );
                    });
{#                    $('#id_cityopt').append('<option value="add">Add city</option>').val('add');#}
                    $("#vendorcontactlist")[0].selectedIndex = 0;

                    }

            }
         });
    }
    else{
        $('#vendorlist').addClass("oh_scd_servkeeComponent oh_scd_servkeeCombobox newscd-dropdown-serviceprovider  has-danger");
        $('#phone').text('');
        $('#email').text('');
        $("#vendorlist")[0].selectedIndex = 0;
{#        document.getElementById('id_lastservicedate').value ='';#}
    }

});

$('#vendorcontactlist').on('change', function() {

    $('#vendorcontactlist').removeClass("has-danger");
    if($("#vendorcontactlist option:selected").val() != '')
        {
            $('#phone').text('');
            $('#email').text('');
            $.ajax({
                url: 'ajax_vendorcontactdetails',
                data: {
                    'vendorselected': $("#vendorlist option:selected").val(),
                    'vendorselectedcontact': $("#vendorcontactlist option:selected").val()
                },
                dataType: 'json',
                success: function (response_data) {
                    console.log(response_data.result);
                    if (response_data.result == 'success' ) {
                        document.getElementById('phone').value =response_data['phone'];
                        document.getElementById('email').value =response_data['email'];
                        }
                }
             });
        }
});

    </script>
{% endblock %}

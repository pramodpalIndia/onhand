{% load i18n admin_static %}
{% load staticfiles i18n compress %}
{% load humanize %}

{% block extrastyle %}
    <link href="{% static 'css/font-awesome.css' %}" rel="stylesheet" media="all">
    <link rel="stylesheet" type="text/css" href="{% static 'css/naic722/dashboard/schedulepopup.css' %}" media="all">
{% endblock %}

<form novalidate class="addnewvendor" autocomplete="off" id="addnewvendor" method="post">
    {% csrf_token %}
    <i class="fa fa-user-o   fa-3x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newvendor-img-headertitle"
       style="color: #073763"></i>
    <span class="oh_scd_servkeeComponent oh_scd_servkeeLabel newvendor-label-headertitle">Add New Vendor Contact</span>
    <div class="oh_scd_servkeeComponent oh_scd_servkeeHrule newvendor-label-titlehorizontol"></div>

    <span class="oh_scd_servkeeComponent oh_scd_servkeeLabel newvendor-label-service">Company</span>
    <span id="vendorcompanyname" name="vendorcompanyname" class="oh_scd_servkeeComponent oh_scd_servkeeLabel newvendor-label-servicedesc">RPZ Test</span>
    <input type="hidden" id="vendorid" name="vendorid" value="">
{#    <div>#}
{#        <div class="oh_scd_servkeeComponent oh_scd_servkeeParagraph ohrequired control-label newvendor-label-vendorname"#}
{#             cellspacing="0"#}
{#             cellpadding="0">Service#}
{#            provider :#}
{#        </div>#}
{#        <input type="text" required autofocus id="vendorname" name="vendorname" placeholder="Service provider company"#}
{#               value=""#}
{#               class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newvendor-input-vendorname"/>#}
{#        <span id="vendorname_message" name="vendorname_message"#}
{#              class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newvendor-message-vendorname oh-alert-error apphelp-block"></span>#}
{#    </div>#}
    <div>
        <div class="oh_scd_servkeeComponent oh_scd_servkeeParagraph newvendor-label-first-name" cellspacing="0"
             cellpadding="0">
            First name
            / Department:
        </div>
        <input id="first_name" name="first_name" required type="text" placeholder="First name / Dept." value=""
               class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newvendor-input-first-name"/>
        <span id="firstname_message" name="firstname_message"
              class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newvendor-message-firstname oh-alert-error apphelp-block"></span>
    </div>
    <div class="oh_scd_servkeeComponent oh_scd_servkeeParagraph newvendor-label-last-name" cellspacing="0"
         cellpadding="0">
        Last name:<br/></div>
    <input id="last_name" name="last_name" required type="text" placeholder="last name" value=""
           class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newvendor-input-last-name"/>

    <div class="oh_scd_servkeeComponent oh_scd_servkeeParagraph newvendor-label-phone" cellspacing="0" cellpadding="0">
        Phone
        no:<br/></div>
    <input id="phone" name="phone" required type="number" placeholder="phone number" value=""
           class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newvendor-input-phone"/>
    <i class="fa fa-phone fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newvendor-img-phone"
       style="color: #080041"></i>

    <div class="oh_scd_servkeeComponent oh_scd_servkeeParagraph newvendor-label-email" cellspacing="0" cellpadding="0">
        Email
        :
    </div>
    <input id="email" name="email" required type="email" placeholder="Email Address" value=""
           class="oh_scd_servkeeComponent oh_scd_servkeeTextinput newvendor-input-email"/>
    <i class="fa fa-envelope-o fa-2x oh_scd_servkeeComponent oh_scd_servkeeIcon rotate360 newvendor-img-email"
       style="color: #080041"></i>


    <div style="margin-top:490px;text-align: right;margin-right: 100px">
        <button type="button" id="createvendorcontact" name="createvendorcontact" class="ui-button ui-corner-all ui-widget"
                style="font-size: 14px; margin-left: 4px;">Create Contact
        </button>
        <button type="button" id="cancelvendorcontact" name="cancelvendorcontact" class="ui-button ui-corner-all ui-widget"
                style="font-size: 14px; margin-left: 4px;">Cancel
        </button>
    </div>
</form>
{% block extrajs %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery-3.1.1.min.js"></script>
    {% compress js %}
        <script src="{% static 'js/jquery-ui1.12.1.js' %}"></script>
    {% endcompress %}

    <script type="text/javascript" language="javascript">

    $(document).ready(function () {
        if(window.parent.$("#vendorlist option:selected").val() != ''){
         document.getElementById("vendorid").value  = window.parent.$("#vendorlist option:selected").val();
         document.getElementById("vendorcompanyname").innerHTML= window.parent.$("#vendorlist option:selected").text();
         window.parent.$('#vendorlist').removeClass("has-danger");
        }
        else
        {
            if (window.parent.$("#dialogschedulepopnewvendorcontact").dialog("isOpen") == true) {
                window.parent.$("#dialogschedulepopnewvendorcontact").dialog("close");
            }
            window.parent.$('#scddiv').show();
            window.parent.$('.ui-button.ui-corner-all.ui-widget.ui-button-icon-only.ui-dialog-titlebar-close').css('display', 'none');
            window.parent.$('#vendorlist').addClass("oh_scd_servkeeComponent oh_scd_servkeeCombobox newscd-dropdown-serviceprovider  has-danger");

        }

{#        recordtype = $('input:hidden[name=recordtype]').val();#}
        });


        function ValidateEmail(email) {
            if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email)) {
                return (true);
            }
            return (false);
        }

        $("#vendorname").focusout(function () {
            if (document.getElementById('vendorname').value != '') {
                vendorname = document.getElementById('vendorname').value;
                $.ajax({
                    url: 'ajax_complianceservice_newvendorvalid',
                    data: {
                        'vendorname': vendorname
                    },
                    dataType: 'json',
                    success: function (response_data) {
                        console.log(response_data.result);
                        document.getElementById("vendorname_message").innerHTML = "";
                        if ($('#vendorname').hasClass("has-danger"))
                            $('#vendorname').removeClass("has-danger");
                        if (response_data.result == 'error') {
                            $('#vendorname').addClass("oh_scd_servkeeComponent oh_scd_servkeeTextinput vendorname  has-danger");
                            document.getElementById("vendorname_message").innerHTML = response_data.error_message;
                        }
                    }
                });
            }
        });


        function form_valid() {
            var form_valid = true;

            if ($('input:hidden[name=vendorid]').val() == '') {
                form_valid = false;
                $('#first_name').addClass("oh_scd_servkeeComponent oh_scd_servkeeTextinput newvendor-input-first-name  has-danger");

            } else {
                $('#first_name').removeClass("has-danger");
            }

{#            if ($('#first_name').hasClass("has-danger"))#}
{#                $('#first_name').removeClass("has-danger");#}
            document.getElementById("firstname_message").innerHTML = "";
            if (document.getElementById('last_name').value != '') {
                if (document.getElementById('first_name').value == '') {
                    form_valid = false;
                    $('#first_name').addClass("oh_scd_servkeeComponent oh_scd_servkeeTextinput newvendor-input-first-name has-danger");
                    document.getElementById("firstname_message").innerHTML = "Firstname required";
                }
            }

            if (document.getElementById('email').value != '') {
                if (ValidateEmail(document.getElementById('email').value) == false) {
                    form_valid = false;
                    $('#email').addClass("oh_scd_servkeeComponent oh_scd_servkeeTextinput newvendor-input-email  has-danger");
                } else {
                    $('#email').removeClass("has-danger");
                }
            }

            return form_valid;
        }

        $('#createvendorcontact').click(function () {
            if (form_valid() == true) {

                vendorid = $('input:hidden[name=vendorid]').val();
                firstname = document.getElementById('first_name').value;
                lastname = document.getElementById('last_name').value;
                phone = document.getElementById('phone').value;
                email = document.getElementById('email').value;
                console.log('Form Valid -AJAX- Create Vendor contact call');
                $.ajax({
                    url: 'ajax_complianceservice_addnewvendorcontact',
                    data: {
                        'vendorid': vendorid,
                        'firstname': firstname,
                        'lastname': lastname,
                        'phone': phone,
                        'email': email
                    },
                    dataType: 'json',
                    success: function (response_data) {
                        console.log(response_data.result);
                        if (response_data.result == 'success') {
                            window.parent.$('#vendoraddicon').hide();
                            window.parent.$('#scddiv').show();
                            window.parent.$('.ui-button.ui-corner-all.ui-widget.ui-button-icon-only.ui-dialog-titlebar-close').css('display', 'none');
{#                            window.parent.$('#vendorcontactrefreshicon').css('visibility', 'visible');#}
                            window.parent.$('#vendoraddicon').hide();
                            window.parent.$('#vendorcontactaddicon').hide();
{#                            vendor_id = '<option value=' + response_data.vendor + '>'+vendorname+'</option>';#}
                            vendor_contact_id = '<option value=' + response_data.vendorcontactrole + '>'+firstname + ' ' + lastname +'</option>';
                            {#            window.parent.$('#vendorlist').append('<option value="ZeroInVendor" selected>Bajgierowicz Backflow Testers</option>');#}
{#                            window.parent.$('#vendorlist').find('option').remove().end();#}
{#                            window.parent.$('#vendorlist').append('<option value=" ">Bajgierowicz Backflow Testers</option>').val('add');#}
{#                            window.parent.$('#vendorlist').append(vendor_id).val('add');#}
{#                            window.parent.$("#vendorlist")[0].selectedIndex = 0;#}
                            window.parent.$('#vendorcontactlist').find('option').remove().end();
                            {#            window.parent.$('#vendorcontactlist').append('<option value="ZeroInContact" selected>Pawel Bajgierowicz</option>');#}
                            window.parent.$('#vendorcontactlist').append(vendor_contact_id).val('add');
                            window.parent.$("#vendorcontactlist")[0].selectedIndex = 0;
                            window.parent.$('#phone').val(phone);
                            window.parent.$('#email').val(email);
                            window.parent.$('#id_schdeduledinputcal').addClass("oh_scd_servkeeComponent oh_scd_servkeeTextinput newscd-input-schedule  val-required");
                        }

                    }
                });
                window.parent.$("#dialogschedulepopnewvendorcontact").dialog("close");
                window.parent.$('#scddiv').show();
                window.parent.$('.ui-button.ui-corner-all.ui-widget.ui-button-icon-only.ui-dialog-titlebar-close').css('display', 'none');
            }

        });

        $('#cancelvendorcontact').click(function () {
            if (window.parent.$("#dialogschedulepopnewvendorcontact").dialog("isOpen") == true) {
                window.parent.$("#dialogschedulepopnewvendorcontact").dialog("close");
            }
            window.parent.$('#scddiv').show();
            window.parent.$('.ui-button.ui-corner-all.ui-widget.ui-button-icon-only.ui-dialog-titlebar-close').css('display', 'none');
        });


    </script>
{% endblock %}
